<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/Music.css"/>
		<style type="text/css">
			
		</style>
	</head>
	<body>
		<!--整体包裹器-->
		<div id="wrap">
			<!--头部-->
			<div id="header">
				<!--头部上半部分-->
				<div id="headerT">
					<h1 id="logo">
						<a href="javascript:;">
							<img src="img/logo.png"/>
						</a>
					</h1>
					<!--雪碧图-->
					<a href="jacascript:;" id="menuBtn" class="menuClose"></a>
					<div id="nav">
						<a href="javascript:;" id="searchBtn">搜索</a>
						<a href="javascript:;">登录</a>
						<a href="javascript:;">注册</a>
					</div>
				</div>
				<!--头部下半部分-->
				<form id="search">
					<input type="text" placeholder="请输入搜索内容"/>
					<input type="submit" value="搜索"/>
				</form>
				<!--隐藏的导航区域-->				
				<ul id="mask">
					<li>
						<a href="javascript:;">首页</a>
					</li>
					<li>
						<a href="javascript:;">MV</a>
					</li>
					<li>
						<a href="javascript:;">悦单</a>
					</li>
					<li>
						<a href="javascript:;">V榜</a>
					</li>
					<li>
						<a href="javascript:;">音悦</a>
					</li>
					<li>
						<a href="javascript:;">商城</a>
					</li>
					<li>
						<a href="javascript:;">节目</a>
					</li>
					<li>
						<a href="javascript:;">饭团</a>
					</li>
					<li>
						<a href="javascript:;">资讯</a>
					</li>
					<li>
						<a href="javascript:;">我的家</a>
					</li>
				</ul>
				
			</div>
			<!--内容区-->
			<div id="Cwrap">			
				<div id="content">
					<!--导航横条-->
					<nav id="navs">
						<ul id="navList">
							<li class="active">
								<a href="javascript:;">首页</a>
							</li>
							<li>
								<a href="javascript:;">MV</a>
							</li>
							<li>
								<a href="javascript:;">悦单</a>
							</li>
							<li>
								<a href="javascript:;">V榜</a>
							</li>
							<li>
								<a href="javascript:;">音悦</a>
							</li>
							<li>
								<a href="javascript:;">商城</a>
							</li>
							<li>
								<a href="javascript:;">节目</a>
							</li>
							<li>
								<a href="javascript:;">饭团</a>
							</li>
							<li>
								<a href="javascript:;">资讯</a>
							</li>
							<li>
								<a href="javascript:;">我的家</a>
							</li>
						</ul>
					</nav>
					<!--无缝滑屏-->
					<div id="pic-wrap">
						<ul id="pic-list">
							<li>
								<a href="javascript:;">
									<img src="img/1.jpg"/>
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<img src="img/2.jpg"/>
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<img src="img/3.jpg"/>
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<img src="img/4.jpg"/>
								</a>
							</li>
							<li>
								<a href="javascript:;">
									<img src="img/5.jpg"/>
								</a>
							</li>
						</ul>
						<div id="pic-nav">
							<span class="active"></span>
							<span></span>
							<span></span>
							<span></span>
							<span></span>
						</div>
					</div>
				
					<!--tab-->
					<div class="tab">
						<div class="tab-h">
							<h2>MV首播</h2>
							<a href="javascript:;">更多&gt;</a>
						</div>
						<div class="tab-nav">
							<a href="javascript:;">全部</a>
							<a href="javascript:;">内地</a>
							<a href="javascript:;">港台</a>
							<a href="javascript:;">欧美</a>
							<a href="javascript:;">韩国</a>
							<a href="javascript:;">日本</a>
							<!--小绿条-->
							<span></span>
						</div>
						<div class="tab-pic">
							<ul class="loading"></ul>
							<ul class="tab-list">
								<li>
									<a href="javascript:;">
										<img src="img/a.jpg"/>
										<span>内容描述内容描述内容描述内容描述内容描述内容描述</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/b.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/c.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/d.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/e.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/f.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
							</ul>			
							<ul class="loading"></ul>						
						</div>					
					</div>
					
					<div class="tab">
						<div class="tab-h">
							<h2>MV首播</h2>
							<a href="javascript:;">更多&gt;</a>
						</div>
						<div class="tab-nav">
							<a href="javascript:;">全部</a>
							<a href="javascript:;">内地</a>
							<a href="javascript:;">港台</a>
							<a href="javascript:;">欧美</a>
							<a href="javascript:;">韩国</a>
							<a href="javascript:;">日本</a>
							<span></span>
						</div>
						<div class="tab-pic">
							<ul class="loading"></ul>
							<ul class="tab-list">
								<li>
									<a href="javascript:;">
										<img src="img/a.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/b.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/c.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/d.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/e.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/f.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
							</ul>			
							<ul class="loading"></ul>						
						</div>					
					</div>
					<div class="tab">
						<div class="tab-h">
							<h2>MV首播</h2>
							<a href="javascript:;">更多&gt;</a>
						</div>
						<div class="tab-nav">
							<a href="javascript:;">全部</a>
							<a href="javascript:;">内地</a>
							<a href="javascript:;">港台</a>
							<a href="javascript:;">欧美</a>
							<a href="javascript:;">韩国</a>
							<a href="javascript:;">日本</a>
							<span></span>
						</div>
						<div class="tab-pic">
							<ul class="loading"></ul>
							<ul class="tab-list">
								<li>
									<a href="javascript:;">
										<img src="img/a.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/b.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/c.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/d.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/e.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/f.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
							</ul>			
							<ul class="loading"></ul>						
						</div>					
					</div>
					<div class="tab">
						<div class="tab-h">
							<h2>MV首播</h2>
							<a href="javascript:;">更多&gt;</a>
						</div>
						<div class="tab-nav">
							<a href="javascript:;">全部</a>
							<a href="javascript:;">内地</a>
							<a href="javascript:;">港台</a>
							<a href="javascript:;">欧美</a>
							<a href="javascript:;">韩国</a>
							<a href="javascript:;">日本</a>
							<span></span>
						</div>
						<div class="tab-pic">
							<ul class="loading"></ul>
							<ul class="tab-list">
								<li>
									<a href="javascript:;">
										<img src="img/a.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/b.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/c.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/d.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/e.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
								<li>
									<a href="javascript:;">
										<img src="img/f.jpg"/>
										<span>内容描述。。。</span>
									</a>
									<a href="javascript:;" class="ice">
										<div class="ice-left">
											<span class="ice-pic"></span>
											<span>9167</span>
										</div>
										<div class="ice-right">
											<span class="ice-pic"></span>
											<span>6</span>
										</div>
									</a>
								</li>
							</ul>			
							<ul class="loading"></ul>						
						</div>					
					</div>				
				
				</div>				
			</div>
		</div>
		
		<div id="scrollBar"></div>
		
		<script type="text/javascript" src="js/transformCss.js"></script>
		<script type="text/javascript" src="js/drag.js"></script>
		<script type="text/javascript">
			document.addEventListener('touchstart',function(ev){
				ev.preventDefault();
			});
			
			// rem适配   放在自调函数中，避免污染全局
			(function(){
				var width = document.documentElement.clientWidth/16;
				var styleN = document.createElement('style');
				styleN.innerHTML = 'html{font-size:'+ width +'px !important;}';
				document.head.appendChild(styleN);
			})();
			
			//隐藏的导航菜单的切换
//			changeMask();
			function changeMask(){
				var menuBtn = document.querySelector('#menuBtn');
				var mask = document.querySelector('#mask');
				menuBtn.addEventListener('touchstart',function(ev){
					if(menuBtn.className == 'menuClose'){
						menuBtn.className = 'menuOpen';
						mask.style.display = 'block';
					}else{
						menuBtn.className = 'menuClose';
						mask.style.display = 'none';
					}
					// 取消冒泡（）
					ev.stopPropagation();
				})
				//点击该区域以外的地方菜单也应该隐藏
				document.addEventListener('touchstart',function(){
					if(menuBtn.className == 'menuOpen'){
						menuBtn.className = 'menuClose';
						mask.style.display = 'none';
					}
				})
				// mask区域点击时不隐藏，即取消冒泡到document
				mask.addEventListener('touchstart',function(ev){
					ev.stopPropagation();
				})				
			}
			
			// 文本框获取焦点和失去焦点
//			changeFocus();
			function changeFocus(){
				var inputN = document.querySelector('#search input[type=text]');
				inputN.addEventListener('touchstart',function(){
					this.focus();
				})
				document.addEventListener('touchstart',function(){
					inputN.blur();
				})
			}
			
			// 点击导航条上不同li，选中的变色
//			changeColor();
			function changeColor(){
				var lis = document.querySelectorAll('#navList li');
				// 遍历
				for (var i=0;i<lis.length;i++) {
					//给每一个li绑定事件
					lis[i].addEventListener('touchmove',function(){
						// 误触变色。禁止滑动导航条时touchend触发变色的效果
						if(!this.ismove){
							//this.ismove，本没有的的属性,用于判断，标记是否有move
							this.ismove = true;
						}
					})
					lis[i].addEventListener('touchend',function(){
						// 判断是否是误触引发的事件,若是move过来的end则不执行变色
						if(!this.ismove){
							//清除每一个li上的样式，只给当前点击的添加样式
							for (var j=0;j<lis.length;j++) {
								lis[j].className = '';
							}
							this.className = 'active';
						}
						this.ismove = false;  //置回，不影响下次判断。
					})					
				}
			}
			
			// 导航横条的滑屏（点击nav，ul滑动）
//			changeNav();
			function changeNav(){
				var navs = document.querySelector('#navs');
				var navList = document.querySelector('#navList');
				
				var startX = 0;
				var eleX = 0;	
				var minWidth = document.documentElement.clientWidth - navList.offsetWidth;
				
				//上一点的位置和时间
				var lastPoint = 0;
				var lastTime = 0;
				//当前点的位置和时间
				var nowPoint = 0;
				var nowTime = 0;
				// 位移差和时间差
				var disPoint = 0;
				//var disTime = 0;
				//存在bug，点击没有触发move时，有遗留速度，仍会挪动，解决
				// 方法一：
				var disTime = 1; //不通过move，则不计算disTime
				// 方法二:end中不使用disTime，而是直接用时间差，(0-0)不完全是0；此时仍有微弱移动
				// 		在start	末将disPoint 重置为  0			
				
				navs.addEventListener('touchstart',function(ev){
					var touch = ev.changedTouches[0];
					navList.style.transition = 'none';
					startX = touch.clientX;
//					eleX = navList.offsetLeft;
					eleX = transformCss(navList,'translateX');  //读值
										
					lastPoint = eleX;
					lastTime = new Date().getTime();  //取到毫秒值
					
					// 清空速度
					disPoint = 0;
				})
				navs.addEventListener('touchmove',function(ev){
					var touch = ev.changedTouches[0];
					var nowX = touch.clientX;
					var disX = nowX - startX;
					//元素移动距离
					var translateX = eleX + disX;
					// 判断，限定范围,越来越难拖动的效果
					var scale = 0;
//					var minWidth = document.documentElement.clientWidth - navList.offsetWidth;
					if(translateX > 0){
						//translateX = 0;
						scale = 0.9-translateX/document.documentElement.clientWidth;
						//偏移量translateX增大，scale减小，则越往后可拉动的距离越小
						translateX = translateX*scale;
					}else if(translateX < minWidth){
						var over = minWidth - translateX;  //正值,右边留白距离
						scale = 0.9-over/document.documentElement.clientWidth;
						translateX =minWidth - over*scale;
					}
//					navList.style.left = eleX +(nowX - startX) + 'px';
					transformCss(navList,'translateX',translateX);  //写
					
					nowPoint = translateX;
					nowTime = new Date().getTime();
					disPoint = nowPoint - lastPoint;
					disTime = nowTime - lastTime;
				})
				// 手指抬起时，导航条加速效果。即时速度取不到，可以模拟一个速度
				navs.addEventListener('touchend',function(ev){
					var touch = ev.changedTouches[0];
					
//					var speed = disPoint/disTime;
					var speed = disPoint/(nowTime-lastTime);
					//console.log(speed);
					var target = transformCss(navList,'translateX') + speed*100;
//					var minWidth = document.documentElement.clientWidth - navList.offsetWidth;
					//回弹效果（贝塞尔曲线效果）
					var bezier = '';  //只有进入判断贝塞尔才生效
					if(target > 0){
						target = 0;
						bezier = 'cubic-bezier(.03,1.58,.73,1.5)';
					}else if(target < minWidth){
						target = minWidth;
						bezier = 'cubic-bezier(.03,1.58,.73,1.5)';
					}					
					navList.style.transition = '0.5s '+ bezier;
					transformCss(navList,'translateX',target);
				})
			}
			
			window.onload = function(){
				changeMask();
				changeFocus();
				changeNav();
				changeColor();
				slide();
				changeTab();
				Cwrap();
			}
			
			// 无缝滑屏（防抖动:判断比较手指XY方向上的移动距离）
			//slide();
			function slide(){
				var wrap = document.getElementById('pic-wrap');
				var list = document.getElementById('pic-list');
				list.innerHTML += list.innerHTML;
				var liNodes = document.querySelectorAll('#pic-list li');
				var spanNodes = document.querySelectorAll('#pic-nav span');
				
				//布局元素
				var styleN = document.createElement('style');
				var cssText = '#pic-wrap{height: '+ liNodes[0].offsetHeight +'px;}';
				// 此时pic-wrap的高度未添加进去，延时调用此处也不管用，采用window.onload
				cssText += '#pic-list{width: '+ liNodes.length +'00%;}';
				cssText += '#pic-list li{width: '+ 100/liNodes.length +'%;}'
				styleN.innerHTML = cssText;
				document.head.appendChild(styleN);
				
				//定义元素初始位置
				var eleX = 0;
				//定义手指初始位置
				var startX = 0;
				//手指之间的距离
				var disX = 0;
				//定时器
				var timer = 0;
				//定义图片索引
				var now = 0;
				
				// Y方向上的手指距离
				var startY = 0;	
				// 防抖动
				// 判断用户手指第一次move
				var isFirst = true;
				// 是否执行X方向上的逻辑
				var isX = true;
				
				wrap.addEventListener('touchstart',function(ev){
					var touch = ev.changedTouches[0];
					//关定时器
					clearInterval(timer);					
					//清除过渡
					list.style.transition = 'none';					
					//无缝滑屏
					var left = transformCss(list,'translateX');
					now = Math.round(-left/document.documentElement.clientWidth);
					if(now == 0){
						now = spanNodes.length;
					}else if(now == liNodes.length-1){
						now = spanNodes.length - 1;
					};
					//跳转过程
					transformCss(list,'translateX',-now*document.documentElement.clientWidth)
					
					startX = touch.clientX;
					eleX = transformCss(list,'translateX');
					
					startY = touch.clientY;
					
					// 重置
					isX = true;
					isFirst = true;
				})
				wrap.addEventListener('touchmove',function(ev){
					var touch = ev.changedTouches[0];
					
					// 看门狗
					if(!isX){
						return;
					};
					
					//现在手指位置
					var nowX = touch.clientX;
					disX = nowX - startX;
					
					var nowY = touch.clientY;
					var disY = nowY - startY;
					
					if(isFirst){
						isFirst = false;
						if(Math.abs(disY) > Math.abs(disX)){
							isX = false;
						}
					}
					/*
					// 判断XY方向上的距离
					if(Math.abs(disY) > Math.abs(disX)){  //Math.abs() 绝对值
						return; // 后面的代码都不执行
						// 此法对Y方向上的直线滑动有效，对不规则的w、v或其他则不生效，仍抖动
					}
					*/
					transformCss(list,'translateX',eleX + disX)
				})
				wrap.addEventListener('touchend',function(){
					var left = transformCss(list,'translateX');
					now = Math.round(-left/document.documentElement.clientWidth);
					
					//限定now范围
					if(now<0){
						now = 0
					}else if(now > liNodes.length-1){
						now = liNodes.length-1
					}
					
					list.style.transition = '0.5s';
					transformCss(list,'translateX',-now * document.documentElement.clientWidth)
					
					//同步小圆点
					for (var i=0;i<spanNodes.length;i++) {
						spanNodes[i].className = '';
					}
					spanNodes[now%spanNodes.length].className = 'active';					
					//开定时器
					auto();
				})
				//自动轮播
				auto();
				function auto(){
					clearInterval(timer);
					timer = setInterval(function(){
						//空白区域
						if(now == liNodes.length-1){
							now = spanNodes.length-1;
						};
						list.style.transition = 'none';
						transformCss(list,'translateX',-now* document.documentElement.clientWidth)
						
						setTimeout(function(){
							now++;
							list.style.transition = '0.5s';
							transformCss(list,'translateX',-now* document.documentElement.clientWidth)
							//同步小圆点
							for (var i=0;i<spanNodes.length;i++) {
								spanNodes[i].className = '';
							}
							spanNodes[now%spanNodes.length].className = 'active';
						},20);
						
					},1000)					
				}
			}
			
			// tab区域
			function changeTab(){  
				var wrap = document.querySelectorAll('.tab-pic');
				var tabNav = document.querySelectorAll('.tab-nav');	
				
				var translateX = tabNav[0].offsetWidth;
				
				for(var i=0;i<wrap.length;i++){
					// 将主体内容置回
					//transformCss(wrap[i],'translateX',-translateX);
					move(wrap[i],tabNav[i]);
				}
				
				// 究竟拖动的哪个区域，为方便操作，将之封装为move函数，包括滑动在内
				function move(wrap,tabNav){
					transformCss(wrap,'translateZ',0.01);  // 解决滑动变换时一闪一闪的效果
					// 将主体内容置回
					transformCss(wrap,'translateX',-translateX);
					
					// 简单的拖拽
					var startX = 0;
					var eleX = 0;	
					// 防抖动
					var startY = 0;
					var isFirst = true;
					var isX = true;
					
					// loading标识，一开始是不出现的
					var isload = false;
					var loading = wrap.querySelectorAll('.loading');  //对应wrap下的loading
					
					// 获取 绿色 的滚动线（在确定页面跳转时滑动，随着改变位置）
					// 可以操作的位置？？（touchend中可以不）
					var sliderLine = tabNav.querySelector('span');  //对应tabNav下的span
					transformCss(sliderLine,'translateZ',0.01);
					var aNodes = tabNav.querySelectorAll('a');
//					var sliderLine = document.querySelectorAll('.tab-nav span');
//					var aNodes = document.querySelectorAll('.tab-nav a');
					var now = 0;  // 模拟a的索引
					
					wrap.addEventListener('touchstart',function(ev){					
						var touch = ev.changedTouches[0];
												
						if(isload){
							return;
						}
						
						// 清空过渡
						wrap.style.transition = 'none'; 
						startX = touch.clientX;
						startY = touch.clientY;
						eleX = transformCss(wrap,'translateX');	
						
						isFirst = true;
						isX = true;
					})
					wrap.addEventListener('touchmove',function(ev){
						var touch = ev.changedTouches[0];
						
						if(isload){
							return;
						}
						
						// 看门狗
						if(!isX){
							return;
						}
						var nowX = touch.clientX;  // move是一个持续的过程，该值持续变化
						var disX = nowX - startX;
						var nowY = touch.clientY;
						var disY = nowY - startY;
						
						if(isFirst){
							isFirst = false;
							if(Math.abs(disY) > Math.abs(disX)){
								//return;
								isX = false; // mova是一个持续的过程
							}
						}
						
						
						// move过程中，手指拖动多少就移动多少
						transformCss(wrap,'translateX',eleX+disX);
						
						// 限定范围以及跳转临界，设置当手指划过1/2距离时跳转到下/上一页面loading
						// disX>0,手指右滑,上一页面; disX<0，手指左滑，下一页面
						if(Math.abs(disX) > translateX/2){
							
							// 只有当划过1/2页面跳转才出现loading
							isload = true;
							
							var target = (disX>0?0:-2*translateX);
							wrap.style.transition = '0.5s'; // 再次进入时要清空过渡
							transformCss(wrap,'translateX',target);
							
							// 当过渡彻底结束，loading出现（即前一页面彻底跳转不见）
							wrap.addEventListener('transitionEnd',transitionEnd);
							wrap.addEventListener('webkitTransitionEnd',transitionEnd);
						}
						
						function transitionEnd(){
							// 解绑
							wrap.removeEventListener('transitionEnd',transitionEnd);
							wrap.removeEventListener('webkitTransitionEnd',transitionEnd);
							
							for (var i=0;i<loading.length;i++) {
								loading[i].style.opacity = '1';
							}
							
							// 操作 - 小绿条的滑动
							if(disX < 0){
								now = now +1;
							}else{
								now = now - 1;
							}
							if(now < 0){
								now = aNodes.length - 1;
							}else if(now > aNodes.length - 1){
								now = 0;
							}
							sliderLine.style.transition = '0.5s';
							transformCss(sliderLine,'translateX',aNodes[now].offsetLeft);
							
							// 模拟加载结束（页面加载出来，替换loading） -延时调用
							setTimeout(function(){
								wrap.style.transition = 'none';
								transformCss(wrap,'translateX',-translateX);
								isload = false;
								for (var i=0;i<loading.length;i++) {
									loading[i].style.opacity = '0';
								}
								
							},1000)
						}
						
					})
					//点击结束时若disX的距离不足1/2，则跳转回当前特面
					wrap.addEventListener('touchend',function(ev){
						var touch = ev.changedTouches[0];
						
						if(isload){
							return;
						}
						
						var nowX = touch.clientX;
						var disX = nowX - startX;
						if(Math.abs(disX) < translateX/2){
							//var target = (disX>0?0:-2*translateX);
							wrap.style.transition = '0.5s';
							transformCss(wrap,'translateX',-translateX);
						}
						
					})
										
				}				
								
			}
			
			// 内容区整屏竖向滑动
			function Cwrap(){
				var Cwrap = document.querySelector('#Cwrap');
				// 滚动条
				var scrollBar = document.querySelector('#scrollBar');
				var content = document.querySelector('#content');
				var scale = document.documentElement.clientHeight/content.offsetHeight;
				scrollBar.style.height = document.documentElement.clientHeight*scale + 'px';
				
				var callback = {			
					start:function(){
						console.log('start'); // 滚动条一开始不可见，当鼠标点击时才出现，伴随着手指拖动而移动
						//scrollBar.style.opacity = '1';
					},
					move:function(){
						//console.log('move');  // touchmove拖动过程滚动条可见，并且滑动
						scrollBar.style.opacity = '1';
						// 内容偏移量 = 滚动条的偏移量  / scale
						var dis = -transformCss(content,'translateY')*scale;
						transformCss(scrollBar,'translateY',dis)
					},
					end:function(){
						//console.log('end');  // 点击结束滚动条隐藏（内容区在touch结束后仍会滑动，此时滚动条应同步）
						scrollBar.style.opacity = 0;
					}			
				};
				
				Cdrag(Cwrap,callback);
			}
			
		</script>
		
	</body>
</html>
